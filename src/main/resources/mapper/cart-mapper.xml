<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="Cart">
    <!--  장바구니에 동일한 상품이 있나 확인  -->
    <select id="countCart" parameterType="java.util.Map" resultType="int">
        select count(*)
        from cart_table
        where memberId = #{memberId}
          and productId = #{productId}
    </select>
    <!--    장바구니에 동일한 상품이 존재하면 수정-->
    <update id="updateCart" parameterType="cart">
        update cart_table
        set productCnt = productCnt + #{productCnt}
        where memberId = #{memberId}
          and productId = #{productId}
    </update>
    <!--    장바구니 추가하기-->
    <insert id="insert" parameterType="cart">
        insert into cart_table(memberId, productId, productCnt)
        values (#{memberId}, #{productId}, #{productCnt})
    </insert>
    <!--    장바구니 리스트-->
    <select id="listCart" parameterType="Long" resultType="cart">
        SELECT c.id,
               c.memberId,
               p.id AS productId,
               m.memberName,
               p.productTitle,
               c.productCnt,
               p.productPrice,
               (p.productPrice * c.productCnt) AS money
        FROM cart_table c
                 INNER JOIN smember_table m ON m.id = c.memberId
                 INNER JOIN product_table p ON p.id = c.productId
        WHERE c.memberId = #{memberId}
        ORDER BY c.id
    </select>
    <!--    장바구니 전체 금액-->
    <select id="sumMoney" parameterType="Long" resultType="int">
        SELECT COALESCE(SUM(p.productPrice * c.productCnt), 0) AS money
        FROM cart_table c,
             product_table p
        WHERE c.productId = p.id
          AND c.memberId = #{memberId}

    </select>
</mapper>